user www-data;
worker_processes 4;
pid /run/nginx.pid;

events {
        worker_connections 768;
        # multi_accept on;
}

http {

        proxy_cache_path /tmp/nginx_cache keys_zone=FOS_CACHE:10m;

	server {
		listen 80;
	
		access_log    /var/log/nginx/nginx.foscache.log upstream;
		error_log     /var/log/nginx/nginx.foscache.error.log debug;

		# Make site accessible from http://localhost/
		server_name localhost;

		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

		location / {
			proxy_cache FOS_CACHE;
			proxy_pass http://127.0.0.1:8080;
			proxy_cache_key    $uri$is_args$args;
	      		proxy_ignore_headers Expires Cache-Control;
	      		proxy_cache_valid 200 302 301 404 10m;
		}

		location ~ /purge(/.*) {
			allow 127.0.0.1;
			deny all;
			proxy_cache_purge FOS_CACHE $1$is_args$args;
		}

	}

}
